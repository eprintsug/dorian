<?xml version="1.0" ?>

<!-- 
	Full "abstract page" (or splash page or summary page, depending on your jargon) for an eprint. 
-->

<cite:citation xmlns="http://www.w3.org/1999/xhtml" xmlns:epc="http://eprints.org/ep3/control" xmlns:cite="http://eprints.org/ep3/citation" >

  <div class="dorian-main">

  <!-- TAB CONTROLS -->
  <div class="dorian-bar ep-bg">
        <epc:if test="$item.has_type('image')">
            <button class="dorian-bar-item dorian-button tablink ep-fg" onclick="openTab(event,'Images')" data-panel="Images">Images</button>
        </epc:if>
        <epc:if test="$item.has_type('video') or $item.url_is_video('official_url')">
            <button class="dorian-bar-item dorian-button tablink" onclick="openTab(event,'Video')" data-panel="Video">Video</button>
        </epc:if>
        <epc:if test="$item.has_type('audio')">
            <button class="dorian-bar-item dorian-button tablink" onclick="openTab(event,'Audio')" data-panel="Audio">Audio</button>
        </epc:if>
        <epc:if test="$item.has_docs() and ($item.has_type('image') or $item.has_type('video') or $item.has_type('audio'))">
            <button class="dorian-bar-item dorian-button tablink" onclick="openTab(event,'Downloads')" data-panel="Downloads">Downloads</button>
        </epc:if>
        <epc:if test="($item.has_docs() and ($item.has_type('image') or $item.has_type('video') or $item.has_type('audio'))) or $item.url_is_video('official_url'))">
            <button id="Metadata-button" class="dorian-bar-item dorian-button tablink" onclick="openTab(event,'Metadata')" data-panel="Metadata">Metadata</button>
        </epc:if>
  </div>

<!-- IMAGES --> 
<epc:if test="$item.has_type('image')">
  <epc:set name='images' expr="$item.get_type('image')">
  <div id="Images" class="dorian-container dorian-border dorian-panel">
    <div id="image_container" class="free-wall picture">
        <epc:foreach expr="$images" iterator="image">
          <div class="item brick">
		  <a href="{$image.url()}" itemprop="contentUrl" data-size="{$image.property('media_width')}x{$image.property('media_height')}">
			<img src="{$image.thumbnail_url('preview')}" itemprop="thumbnail" alt="Image description" data-index="{$index}" />
              </a>
          </div>
        </epc:foreach>
    </div>
  </div>
  </epc:set>
</epc:if>

<!-- VIDEO -->
<epc:if test="$item.has_type('video') or $item.url_is_video('official_url')">
  <epc:set name='videos' expr="$item.get_type('video')">
     <div id="Video" class="dorian-container dorian-border dorian-panel" style="display:none">
	<!-- LOOP THROUGH ITEM VIDEO FILES and youtube/vimeo urls -->
        <epc:foreach expr="$videos" iterator="video">
          <div class="plyr_container">
		<video id="plyr_{$index}" playsinline="true" controls="true" 
			data-doc-title="{$video.property('main')}"
			class="video">
	     <source src="{$video.url()}" type="{$video.property('mime_type')}" />
	       <!-- Captions are optional -->
	       <!-- <track kind="captions" label="English captions" src="/path/to/captions.vtt" srclang="en" default />-->
              </video>
	  </div>
        </epc:foreach>
	<epc:if test="$item.property('official_url') and $item.url_is_video('official_url')">
          <div class="plyr_container">
	    <div class="plyr__video-embed" id="player_official_url">
		<iframe
			src="{$item.url_to_embed('official_url')}"
		    allowfullscreen="true"
		    allowtransparency="true"
		    allow="autoplay"></iframe>
	     </div>
	   </div>
	 </epc:if>
     </div>
  </epc:set> 
</epc:if>

<!-- AUDIO -->
<epc:if test="$item.has_type('audio')">
  <epc:set name='audios' expr="$item.get_type('audio')">
  <div id="Audio" class="dorian-container dorian-border dorian-panel" style="display:none">
        <epc:foreach expr="$audios" iterator="audio">
            <div class="dorian_audio_file_name">
                <br/>
                <epc:print expr="$index"/> - <print expr="$audio.property('main')"/>
                <br/>
            </div>
          <div class="plyr_container">
              <audio id="audio_plyr_{$index}" controls="true">
	     		<source src="{$audio.url()}" type="{$audio.property('mime_type')}" />
     		</audio>
            </div>
        </epc:foreach>
    <!-- <epc:comment> TEST Maybe do embedding of audio services... maybe sound cloud. Not supported by plyr, but maybe a default soundcloud iframe 
	<epc:if test="$item.property('official_url') and $item.url_is_audio('official_url')">
	    <div class="plyr__video-embed" id="player_official_url">
		<iframe
			src="{$item.url_to_embed_audio('official_url')}"
		    allowfullscreen="true"
		    allowtransparency="true"
		    allow="autoplay"></iframe>
	    </div>
	 </epc:if>
	</epc:comment> 	-->
  </div>
  </epc:set> 
</epc:if>

<!-- DOWNLOADS AKA everything else -->
<epc:if test="$item.has_docs() and ($item.has_type('image') or $item.has_type('video') or $item.has_type('audio'))">
    <!-- if we have docs either multimedia or additional to mm we have a dowloads panel -->
  <div id="Downloads" class="dorian-container dorian-border dorian-panel" style="display:none">
     <div class="downloads_container">
      <epc:set name='docs' expr='$item.documents()'>
        <epc:if test="length($docs) = 0">
          <epc:phrase ref="page:nofulltext" />
          <epc:if test="$item.contact_email().is_set() and eprint_status = 'archive'">
            (<a href="{$config{http_cgiurl}}/request_doc?eprintid={eprintid}"><epc:phrase ref="request:button" /></a>)
          </epc:if>
        </epc:if>
      
        <epc:if test="length($docs) gt 0">
          <epc:phrase ref="page:fulltext" />
		<div class="downloads_grid">
		 <epc:foreach expr="$docs" iterator="doc">
		  <a href="{$doc.url()}">
		    <figure>
<!--		      <epc:print expr="$doc.icon('HoverPreview','noNewWindow')}" /> -->
		      <epc:print expr="$doc.icon()" />
		      <figcaption>
			  <epc:print expr="$doc.citation('default')" /><br />
			  <a href="{$doc.url()}" class="ep_document_link"><epc:phrase ref="summary_page:download"/> (<epc:print expr="$doc.doc_size().human_filesize()" />)</a>
			  <epc:if test="!$doc.is_public() and $item.contact_email().is_set() and eprint_status = 'archive'">
			    | <a href="{$config{http_cgiurl}}/request_doc?docid={$doc{docid}"><epc:phrase ref="request:button" /></a>
			  </epc:if>
		      </figcaption>
		    </figure>
		  </a>
		 </epc:foreach>
         	<epc:if test="iiif_manifest_enabled()">
		  <a href="{$config{http_cgiurl}}/export/eprint/{$item.property('eprintid')}/IIIFManifest/nuatest-eprint-{$item.property('eprintid')}.js">
		   <figure>
	  	     <img src="{$config{rel_path}}/images/International_Image_Interoperability_Framework_logo.png" width="68px"/>
		     <figcaption>
			Export IIIF Manifest
			<br/>
			<a href="https://iiif.io/about/">What is IIIF?</a>
		     </figcaption>
		   </figure>
	      	 </a>
         	</epc:if>
		</div>
        </epc:if>
      </epc:set>
    </div>
  </div>
</epc:if>

<!-- METADATA -->

 <div id="Metadata" class="dorian-container dorian-border dorian-panel" style="display:none">

   <div class="metadata_container">

    <epc:if test="!$item.has_type('image') and !$item.has_type('video') !$item.has_type('audio') ">
    <!-- we only have downloadable docs? just show trad. EPrints page (no bar) -->
      <epc:set name='docs' expr='$item.documents()'>

        <epc:if test="length($docs) = 0">
          <epc:phrase ref="page:nofulltext" />
          <epc:if test="$item.contact_email().is_set() and eprint_status = 'archive'">
            (<a href="{$config{http_cgiurl}}/request_doc?eprintid={eprintid}"><epc:phrase ref="request:button" /></a>)
          </epc:if>
        </epc:if>
      
        <epc:if test="length($docs) gt 0">
          <epc:phrase ref="page:fulltext" />
          <table>
            <epc:foreach expr="$docs" iterator="doc">
              <tr>
                <td valign="top" align="right"><epc:print expr="$doc.icon('HoverPreview','noNewWindow')}" /></td>
                <td valign="top">
                  <epc:print expr="$doc.citation('default')" /><br />
                  <a href="{$doc.url()}" class="ep_document_link"><epc:phrase ref="summary_page:download"/> (<epc:print expr="$doc.doc_size().human_filesize()" />)</a>
                  <epc:if test="!$doc.is_public() and $item.contact_email().is_set() and eprint_status = 'archive'">
                    | <a href="{$config{http_cgiurl}}/request_doc?docid={$doc{docid}"><epc:phrase ref="request:button" /></a>
                  </epc:if>
      
                  <ul>
                  <epc:foreach expr="$doc.related_objects('http://eprints.org/relation/hasVersion')" iterator="rel">
                    <epc:if test="$rel{relation_type}!='http://eprints.org/relation/isVolatileVersionOf'">
                      <li><epc:print expr="$rel.citation_link('default')" /></li>
                    </epc:if>
                  </epc:foreach>
                  </ul>
                </td>
              </tr>
            </epc:foreach>
          </table>
        </epc:if>

      </epc:set>

    </epc:if>


  <table style="margin-bottom: 1em; margin-top: 1em;" cellpadding="3">
      <epc:if test="official_url">
        <tr>
          <th align="right"><epc:phrase ref="eprint_fieldname_official_url" />:</th>
          <td valign="top"><epc:print expr="official_url" /></td>
        </tr>
      </epc:if>
    <tr>
      <th align="right"><epc:phrase ref="eprint_fieldname_type" />:</th>
      <td>
        <epc:print expr="type" />
        <epc:if test="type = 'conference_item'">(<epc:print expr="pres_type" />)</epc:if>
        <epc:if test="type = 'monograph'">(<epc:print expr="monograph_type" />)</epc:if>
        <epc:if test="type = 'thesis'">(<epc:print expr="thesis_type" />)</epc:if>
      </td>
    </tr>
    <epc:comment> 
       The below block loops over a list of field names taken from eprint_render.pl
       Edit the list of metadata to show in the summary page table in eprint_render.pl
    </epc:comment>
    <epc:foreach expr="$config{summary_page_metadata}" iterator="fieldname">
      <epc:if test="is_set($item.property($fieldname))">
        <tr>
          <th align="right"><epc:phrase ref="eprint_fieldname_{$fieldname}" />:</th>
          <td valign="top"><epc:print expr="$item.property($fieldname)" /></td>
        </tr>
      </epc:if>
    </epc:foreach>
    <tr>
      <th align="right">URI:</th>
      <td valign="top"><a href="{$item.uri()}"><epc:print expr="$item.uri()" /></a></td>
    </tr>
  </table>
 </div>
 </div>

</div> <!-- end of tabbed stuff -->

<epc:print expr="$item.citation('dorian_photoswipe')"/>

<epc:print expr="$item.citation('dorian_plyr_player')"/>

</cite:citation>

